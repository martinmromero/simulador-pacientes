<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Pacientes Virtuales - Universidad</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/avatar.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <!-- Panel de Configuraci√≥n IA (Izquierda) -->
      <div class="ia-config-panel">
        <div class="ia-status">
          <div class="status-indicator" id="ia-status-indicator">
            <span class="status-dot" id="status-dot"></span>
            <span class="status-text" id="status-text">Verificando...</span>
          </div>
        </div>
        <div class="ia-server-select">
          <select id="ollama-server" class="server-dropdown">
            <option value="servidor">Servidor Intranet</option>
            <option value="local">Notebook Local</option>
          </select>
        </div>
      </div>
      
      <h1>üè• Simulador de Pacientes Virtuales</h1>
      
      <div class="user-info">
        <span id="username">Estudiante</span>
        <button id="logout-btn" class="btn-secondary">Salir</button>
      </div>
    </div>
  </header>

  <!-- Selector de Casos -->
  <section id="case-selector" class="section">
    <div class="container">
      <h2>Selecciona un Caso Cl√≠nico</h2>
      <div id="cases-grid" class="cases-grid">
        <!-- Se llenar√° din√°micamente -->
      </div>
    </div>
  </section>

  <!-- Sala de Entrevista -->
  <section id="interview-room" class="section hidden">
    <div class="container-fluid">
      
      <!-- Panel Principal -->
      <div class="interview-layout">
        
        <!-- Panel Izquierdo: Avatar del Paciente -->
        <div class="avatar-panel">
          <div id="patient-avatar" class="avatar-container">
            <!-- Avatar de video realista -->
            <div class="avatar-video-wrapper">
              <video 
                id="avatar-video" 
                class="avatar-video"
                loop
                muted
                playsinline
                autoplay
              >
                <source src="assets/coverr-temp-irx5gen-3-alpha-3810106825-steady-cam-talking-60c14a1a-9f9b-4c95-8-mp4-7682-1080p.mp4" type="video/mp4">
                <source src="assets/istockphoto-1152822473-640_adpp_is.mp4" type="video/mp4">
                Tu navegador no soporta video HTML5.
              </video>
              <div class="avatar-overlay" id="avatar-overlay"></div>
            </div>
            
            <!-- Indicadores de estado -->
            <div class="avatar-status">
              <div class="emotion-indicator" id="emotion">
                <span class="label">Estado:</span>
                <span id="emotion-text">Neutral</span>
              </div>
              <div class="speaking-indicator hidden" id="speaking-indicator">
                <span class="pulse"></span> Hablando...
              </div>
            </div>
          </div>
          
          <!-- Info del Paciente -->
          <div class="patient-info">
            <h3 id="patient-name">Nombre del Paciente</h3>
            <p id="patient-details">Edad ‚Ä¢ Ocupaci√≥n</p>
            <p class="consultation-reason" id="consultation-reason"></p>
          </div>
        </div>

        <!-- Panel Central: Conversaci√≥n -->
        <div class="conversation-panel">
          
          <!-- Historial de Chat -->
          <div id="chat-container" class="chat-container">
            <div id="chat-messages" class="chat-messages">
              <!-- Los mensajes se agregar√°n aqu√≠ -->
            </div>
          </div>

          <!-- Controles de Entrada -->
          <div class="input-controls">
            
            <!-- √Årea de texto -->
            <div class="input-group">
              <textarea 
                id="message-input" 
                class="message-input" 
                placeholder="Escribe tu pregunta o comentario..."
                rows="3"
              ></textarea>
            </div>

            <!-- Botones de acci√≥n -->
            <div class="action-buttons">
              <button id="voice-btn" class="btn-voice" title="Hablar con micr√≥fono">
                <span class="icon">üé§</span>
                <span class="text">Voz</span>
              </button>
              
              <button id="send-btn" class="btn-primary">
                <span class="icon">üì§</span>
                <span class="text">Enviar</span>
              </button>
            </div>

            <!-- Modo de comunicaci√≥n -->
            <div class="communication-mode">
              <label class="toggle-label">
                <input type="checkbox" id="audio-response-toggle" checked>
                <span class="toggle-slider"></span>
                <span class="toggle-text">Respuestas por audio</span>
              </label>
            </div>

          </div>

        </div>

        <!-- Panel Derecho: Notas y Herramientas -->
        <div class="tools-panel">
          
          <div class="session-info">
            <h4>Sesi√≥n Actual</h4>
            <p>Tiempo: <span id="session-time">00:00</span></p>
            <p>Mensajes: <span id="message-count">0</span></p>
          </div>

          <div class="notes-section">
            <h4>Notas de la Entrevista</h4>
            <textarea 
              id="student-notes" 
              class="student-notes" 
              placeholder="Escribe tus observaciones, impresiones diagn√≥sticas, preguntas para supervisi√≥n..."
            ></textarea>
          </div>

          <div class="session-controls">
            <button id="pause-session-btn" class="btn-secondary">‚è∏Ô∏è Pausar</button>
            <button id="end-session-btn" class="btn-danger">üîö Finalizar Entrevista</button>
          </div>

        </div>

      </div>

    </div>
  </section>

  <!-- Modal de Fin de Sesi√≥n -->
  <div id="end-session-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Finalizar Entrevista</h3>
      <p>¬øEst√°s seguro de que deseas finalizar esta sesi√≥n?</p>
      
      <div class="self-evaluation">
        <h4>Autoevaluaci√≥n (opcional)</h4>
        <label>
          ¬øC√≥mo evaluar√≠as tu desempe√±o?
          <select id="self-rating">
            <option value="">Selecciona...</option>
            <option value="5">Excelente</option>
            <option value="4">Muy bien</option>
            <option value="3">Bien</option>
            <option value="2">Regular</option>
            <option value="1">Necesito mejorar</option>
          </select>
        </label>
        
        <label>
          Comentarios adicionales:
          <textarea id="self-comments" rows="3" placeholder="¬øQu√© aprendiste? ¬øQu√© har√≠as diferente?"></textarea>
        </label>
      </div>

      <div class="modal-actions">
        <button id="cancel-end-btn" class="btn-secondary">Cancelar</button>
        <button id="confirm-end-btn" class="btn-primary">Confirmar y Finalizar</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/avatar.js"></script>
  <script src="js/ia-config.js"></script>
  <script src="js/speech.js"></script>
  <script src="js/session.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
